<form version="1.1">
  <label>RDS Adapter Splunk Dashboard</label>
  <description>Switch between environments and time ranges</description>

  <!-- Ensure tokens are set on first load -->
  <init>
    <set token="env">EXTQ0</set>
    <set token="index">qts_dev_apps</set>
    <set token="host">xaapktprxp</set>
    <set token="sourcetype">rds-adapter</set>
    <set token="earliest">-60m@m</set>
    <set token="latest">now</set>
  </init>

  <fieldset submitButton="false">
    <!-- Environment -->
    <input type="dropdown" token="env">
      <label>Environment</label>
      <choice value="EXTQ0">EXTQ0</choice>
      <choice value="PROD">PROD</choice>
      <default>EXTQ0</default>
      <change>
        <eval token="index">case($env$="EXTQ0","qts_dev_apps",$env$="PROD","prod_index","*")</eval>
        <eval token="host">case($env$="EXTQ0","xaapktprxp",$env$="PROD","prod_host","*")</eval>
        <eval token="sourcetype">case($env$="EXTQ0","rds-adapter",$env$="PROD","prod_sourcetype","*")</eval>
      </change>
    </input>

    <!-- Time -->
    <input type="time">
      <label>Select Time Range</label>
      <default>
        <earliest>$earliest$</earliest>
        <latest>$latest$</latest>
      </default>
      <change>
        <set token="earliest">$earliest$</set>
        <set token="latest">$latest$</set>
      </change>
    </input>
  </fieldset>

  <!-- Single tile: case-insensitive "error" count; refresh every 10s -->
  <row>
    <panel>
      <title>Error Event Count</title>
      <single>
        <search>
          <query>
            index=$index$ host=$host$ sourcetype=$sourcetype$
            (status=error OR "error")
            | stats count AS "Error Count"
          </query>
          <earliest>$earliest$</earliest>
          <latest>$latest$</latest>
          <refresh>10</refresh>
          <refreshType>delay</refreshType>
        </search>
        <option name="numberPrecision">0</option>
        <option name="useThousandSeparators">true</option>
        <option name="colorMode">block</option>
        <option name="colorBy">value</option>
      </single>
    </panel>
  </row>
</form>
